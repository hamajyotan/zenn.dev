---
title: "Rails ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã®ã‚¹ã‚³ãƒ¼ãƒ—ã¨ include_all_helpers ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦"
emoji: "ğŸ«"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "rails"
  - "ruby"
published: false
---

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã®ã‚¹ã‚³ãƒ¼ãƒ—ã«ã¤ã„ã¦

ã“ã®è¨˜äº‹ã§ã¯ Rails ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã§å®šç¾©ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒã©ã®ç¯„å›²ã‚’ã‚¹ã‚³ãƒ¼ãƒ—ã¨ã—ã¦ã„ã‚‹ã‹ã€
ãã—ã¦ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å¤‰æ›´ã™ã‚‹æ–¹æ³•ã€ãŠã‚ˆã³æ—¢å­˜ã‹ã‚‰ã®ã‚¹ã‚³ãƒ¼ãƒ—å¤‰æ›´ã®åˆç†çš„ãªæ–¹æ³•ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

# ãƒ˜ãƒ«ãƒ‘ã«å®šç¾©ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã¯ã©ã®ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ã§ã‚‚å‘¼ã³å‡ºã›ã‚‹

ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã« `UsersHelper#display_name` ãŒã‚ã£ãŸã¨ã—ã¦

```ruby:app/helpers/users_helper.rb
module UsersHelper
  def display_name(user)
    "#{user.lastname} #{user.firstname}"
  end
end
```

ã“ã‚Œã¯ã€ `UsersController` ãŒæç”»ã™ã‚‹ã®ã®ãƒ“ã®ãƒ¼ã®ä¸­ã«é™ã‚‰ãšã€åˆ¥ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãŒæç”»ã™ã‚‹ãƒ“ãƒ¥ãƒ¼ã®ä¸­ã§ã‚‚ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```ruby:app/controllers/posts_controller.rb
class PostsController
  def index
    @posts = Post.all
  end
end
```
```erb:app/views/posts/index.html.erb
<% @posts.each do |post| %>
  <p><%= post.content %></p>
  <small><%= display_name(post.user) %></small> <!-- display_name ãŒä½¿ãˆã‚‹ -->
<% end %>
```

ã¤ã¾ã‚Šã€ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã§å®šç¾©ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã¯åŸºæœ¬çš„ã«ã©ã®ãƒ“ãƒ¥ãƒ¼ã§ã‚‚ä½¿ãˆã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã®æŒ™å‹•ã§ã™ãŒã€ãã†ã„ã†ã‚‚ã®ãªã®ã§ã—ã‚‡ã†ã¨å‰²ã‚Šåˆ‡ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã‹ãªã‚Šé©ç”¨ç¯„å›²ãŒåºƒã„ã“ã¨ã«ã‚ˆã‚‹æ‡¸å¿µã¯ã‚ã‚Šã¾ã™ã€‚
ã±ã£ã¨è€ƒãˆã‚‹ã¨ä»¥ä¸‹ã‚ãŸã‚Šã¯æ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚

* ãã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒæœªä½¿ç”¨ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’èª¿ã¹ã‚‹å¿…è¦ãŒã‚ã‚‹
* åˆ¥ã€…ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã§åŒåã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚ŒãŸå ´åˆã®å‹•ãã®æŠŠæ¡ãŒå›°é›£

ãã†ã„ã£ãŸæ‡¸å¿µã«å¯¾ã™ã‚‹å›é¿æ–¹æ³•ã¨ã—ã¦ã€ Rails ã§ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

# config.action_controller.include_all_helpers ã‚ªãƒ—ã‚·ãƒ§ãƒ³

ä¸Šè¨˜ã®ã¨ãŠã‚Šã€ Rails ã® controller ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã™ã¹ã¦ã® helper ã‚’èª­ã¿è¾¼ã¿ã¾ã™ãŒã€ã“ã‚Œã¯ã€ `config.action_controller.include_all_helpers` ã®è¨­å®šå€¤ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚

https://railsguides.jp/configuring.html#config-action-controller-include-all-helpers

> ã™ã¹ã¦ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ã‚ã‚‰ã‚†ã‚‹å ´æ‰€ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã‹ã€å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ã‚¹ã‚³ãƒ¼ãƒ—å†…ã«é™å®šã™ã‚‹ã‹ã‚’è¨­å®šã—ã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã“ã®å€¤ã¯ `true` ã§ã™ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€ã“ã®å€¤ã‚’ `config/application.rb` ã‚ãŸã‚Šã§è¨­å®šã™ã‚‹ã¨æŒ™å‹•ãŒã‹ã‚ã‚Šã¾ã™ã€‚

```diff ruby:config/application.rb
 module Example
   class Application < Rails::Application
     # Initialize configuration defaults for originally generated Rails version.
     config.load_defaults 8.0
+
+   config.action_controller.include_all_helpers = false
```

ãã†ã™ã‚‹ã¨ã€ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã« `UsersHelper` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ `display_name` ã‚’ã€
`PostsController` ãŒæç”»ã™ã‚‹ãƒ“ãƒ¥ãƒ¼ã§ã¯å‘¼ã³å‡ºã›ãªããªã‚Šã¾ã™ã€‚

```ruby:app/helpers/users_helper.rb
module UsersHelper
  def display_name(user)
    "#{user.lastname} #{user.firstname}"
  end
end
```

```ruby:app/controllers/posts_controller.rb
class PostsController
  def index
    @posts = Post.all
  end
end
```
```erb:app/views/posts/index.html.erb
<% @posts.each do |post| %>
  <p><%= post.content %></p>
  <!-- å‘¼ã³å‡ºã›ãªã„ï¼ -->
  <small><%= display_name(post.user) %></small> <!-- undefined method 'display_name' for ... -->
<% end %>
```

## é©ç”¨ã•ã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ã¯ã©ã†ã‚„ã£ã¦æ±ºå®šã•ã‚Œã‚‹ã®ã‹?

ä¾‹ãˆã°ã„ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãŠã‚ˆã³ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã®ç¶™æ‰¿é–¢ä¿‚ãŒã‚ã£ãŸã¨ã—ã¦èª¬æ˜ã—ã¾ã™ã¨

```
app/
â”œâ”€â”€ controllers
â”‚Â Â  â”œâ”€â”€ admin
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ application_controller.rb
â”‚Â Â  â”‚Â Â  â””â”€â”€ users_controller.rb
â”‚Â Â  â”œâ”€â”€ application_controller.rb
â”‚Â Â  â”œâ”€â”€ posts_controller.rb
â”‚Â Â  â””â”€â”€ users_controller.rb
â””â”€â”€ helpers
    â”œâ”€â”€ admin
    â”‚Â Â  â”œâ”€â”€ application_helper.rb
    â”‚Â Â  â””â”€â”€ users_helper.rb
    â”œâ”€â”€ application_helper.rb
    â”œâ”€â”€ posts_helper.rb
    â””â”€â”€ users_helper.rb
```

```ruby:app/controllers/application_controller.rb
class ApplicationController < ActionController::Base
end
```
```ruby:app/controllers/users_controller.rb
class UsersController < ApplicationController
end
```
```ruby:app/controllers/posts_controller.rb
class PostsController < ApplicationController
end
```
```ruby:app/controllers/admin/application_controller.rb
class Admin::ApplicationController < ApplicationController
end
```
```ruby:app/controllers/admin/users_controller.rb
class Admin::UsersController < Admin::ApplicationController
end
```

`UsersController` ã®ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã§é©ç”¨ã•ã‚Œã‚‹ helper ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

1. `UsersHelper`
2. `ApplicationHelper`

ã“ã‚Œã¯ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ã®ç¶™æ‰¿é–¢ä¿‚ã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚
`UsersHelper` ã¯ `ApplicationHelper` ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã®ã§ `users`, `application` ã¨ã„ã†é †ç•ªã§ãŸã©ã‚‹ã‚ã‘ã§ã™ã€‚

ã‚‚ã†ä¸€ä¾‹å‡ºã—ã¾ã™ã¨ã€ `Admin::UsersController` ã®ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã§ã¯é©ç”¨ã•ã‚Œã‚‹ helper ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

1. `Admin::UsersHelper`
2. `Admin::ApplicationHelper`
3. `ApplicationHelper`

ã“ã‚Œã‚‚ã€ç¶™æ‰¿é–¢ä¿‚ã¨ç…§ã‚‰ã—åˆã‚ã›ã‚‹ã¨ã‚ã‹ã‚Šã¾ã™ã€‚
`admin/users`, `admin/application` ãã—ã¦ `application` ã¨ã„ã†é †ç•ªã§ãŸã©ã‚Šã¾ã™ã€‚

ã“ã®æŒ™å‹•ã¯ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã‚’æç”»ã™ã‚‹éš›ã®æ¢ç´¢ãƒ‘ã‚¹ã®ä»•çµ„ã¿ã§ã‚ã‚‹**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç¶™æ‰¿ã¨åŒã˜**å½¢ã§ã™ã€‚
https://railsguides.jp/layouts_and_rendering.html#%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%AE%E7%B6%99%E6%89%BF

# æ—¢å­˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ include_all_helpers ã‚’ false ã«ã—ãŸã„

ãªã‚‹ã»ã©ã“ã‚Œã¯éå¸¸ã«æœ‰ç”¨ã ãªï¼ã¨ã„ã†ã‚ã‘ã§æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ `config.action_controller.include_all_helpers` ã‚’ `false` ã«ã™ã‚‹å ´åˆã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ã‚’ãŸã©ã£ã¦ã¿ã¾ã™ã€‚

## ã¯ã˜ã‚ã®ä¸€æ­©

ã¯ã˜ã‚ã«ã‚„ã‚‹ã“ã¨ã¯ã€ã‚‚ã¡ã‚ã‚“ `config.action_controller.include_all_helpers` è¨­å®šå€¤ã‚’ `false` ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚

```diff ruby:config/application.rb
 module Example
   class Application < Rails::Application
     # Initialize configuration defaults for originally generated Rails version.
     config.load_defaults 8.0
+
+   config.action_controller.include_all_helpers = false
```

ãŸã ã€å˜ç´”ã«ã“ã‚Œã‚’è¨­å®šã—ãŸã ã‘ã ã¨å½“ç„¶ã€ãƒ“ãƒ¥ãƒ¼æç”»æ™‚ã«ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã¨ãªã£ã¦ã—ã¾ã£ãŸãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã®ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¦ã—ã¾ã„ã¾ã™ã€‚
ãã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€ **`ApplicationHelper` ã§ã™ã¹ã¦ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰**ã—ã¾ã™ã€‚ã“ã‚ŒãŒç¬¬ä¸€æ­©ã§ã™ã€‚

```ruby:app/helpers/application_helper.rb
module ApplicationHelper
  include Admin::ApplicationHelper
  include Admin::UsersHelper
  include PostsHelper
  include UsersHelper
end
```

é€šå¸¸ã€å¤šãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’ãŸã©ã‚‹ã¨æœ€çµ‚çš„ã« `ApplicationController` ã«åˆ°é”ã™ã‚‹ã¯ãšã§ã™ã€‚
ãã®å‰æã®å ´åˆ `ApplicationHelper` ã¯ã™ã¹ã¦ã®ãƒ“ãƒ¥ãƒ¼æç”»ã§é©ç”¨å¯èƒ½ãªãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

## æ®µéšçš„ã«ã‚ˆã‚Šã‚ã‘ã‚‹

ã‚ã¨ã¯ã€æ®µéšçš„ã«ã“ã®ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹é–¢ä¿‚ã‚’ç–ã«ã—ã¦ã„ãã¾ã™ã€‚
ãŸã¨ãˆã° `Admin::*` é…ä¸‹ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯å¿…ãš `Admin::ApplicationController` ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã“ã¨ãŒã¯ã£ãã‚Šã—ã¦ã„ã‚‹ãªã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚‚ã§ãã¾ã™ã­ã€‚

```ruby:app/helpers/application_helper.rb
module ApplicationHelper
  include Admin::ApplicationHelper
  include PostsHelper
  include UsersHelper
end
```
```ruby:app/helpers/admin/application_helper.rb
module Admin::ApplicationHelper
  include Admin::UsersHelper
end
```

æœ€çµ‚çš„ã«ã¯ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘åŒå£«ã®ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã‚’ã‚„ã‚ã‚‹ã“ã¨ãŒã§ãã‚Œã°è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
ä¾‹ãˆã° `PostsHelper` ã§å®šç¾©ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰å®šç¾©ãŒ `PostsController` ä»¥å¤–ã§ä½¿ã‚ã‚Œã¦ãªã„ã¨ã¯ã£ãã‚Šã—ãŸã‚‰ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ãŸã‚Š

```diff ruby:app/helpers/application_helper.rb
 module ApplicationHelper
   include Admin::ApplicationHelper
-  include PostsHelper
   include UsersHelper
 end
```

é€†ã«ã€ã„ã‚ã‚“ãªã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã€ `ApplicationHelper` ã®æ–¹ã«å¼•ã£è¶Šã—ã—ã¦ããŸã‚Šã§ã™ã€‚

```diff ruby:app/helpers/application_helper.rb
 module ApplicationHelper
   include Admin::ApplicationHelper
-  include UsersHelper
+
+  def very_useful_helper_method(user)
+    #
+  end
 end
```
```diff ruby:app/helpers/users_helper.rb
 module UsersHelper
-  def very_useful_helper_method(user)
-    #
-  end
 end
```

# å…è²¬äº‹é …ãªã©

ã“ã®è¨˜äº‹ã§ã¯ Rails ã®ãƒ“ãƒ¥ãƒ¼ãƒ˜ãƒ«ãƒ‘ã§å®šç¾©ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒã©ã®ã‚ãŸã‚Šã‚’ã‚¹ã‚³ãƒ¼ãƒ—ã¨ã—ã¦ã„ã‚‹ã‹ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚
ä»¥ä¸‹ã¯ Rails 8.0.2.1 ã§ç¢ºèªã—ã¦ã„ã¾ã™ãŒåŸºæœ¬çš„ã«éå»ã®å¤šãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯åŒæ§˜ã§ã™ã€‚ ^[æ­£ç¢ºã«ã¯ `include_all_helpers` ãŒå°å…¥ã•ã‚ŒãŸ Rails 3.1 ä»¥é™ã‚’å‰æã«ã—ã¦ã„ã¾ã™] ^[å°†æ¥ `include_all_helpers` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒ `false` ã¨ãªã£ãŸå ´åˆã¯è¨˜äº‹å†…å®¹ãŒå°‘ã€…ä¸æ•´åˆã¨ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“]
