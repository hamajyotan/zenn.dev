---
title: "Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Github Codespaces ã§å‹•ã‹ã™ã«ã¯"
emoji: "ğŸ«"
type: "tech"
topics:
  - "github"
  - "rails"
  - "ruby"
published: true
---

ã“ã®è¨˜äº‹ã§ã¯ã€ Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Github Codespaces ã§å‹•ä½œã•ã›ã‚‹ã“ã¨ã‚’ãƒˆãƒ©ã‚¤ã—ã¦ã„ã‚‹å†…å®¹ã§ã™ã€‚
ç¾æ™‚ç‚¹ã§ã¯å°‘ã—ã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã‚’ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã™ã‚‹ã“ã¨ã§ã“ã‚Œã‹ã‚‰è©¦ã™æ–¹ãŒã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆãŒæ¸›ã‚Œã°è‰¯ã„ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚

# çµè«–ã‚’å…ˆã«

- Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Github Codespaces ã§å‹•ã‹ã™ã«ã¯ `--devcontainer` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ãŸ `rails new` ã®æ§‹æˆã§ãŠãŠã‚ˆãå‹•ãã€‚ãŒã€ã„ãã¤ã‹æ³¨æ„ç‚¹ãŒã‚ã‚‹ã€‚
- codespace ã§ãªãã¦ã‚‚å¿…è¦ãªä¸€èˆ¬çš„ãªæ³¨æ„ç‚¹
  - `localhost` ã§ã¯ãªã„ãƒ‰ãƒ¡ã‚¤ãƒ³åã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ãªã‚‹ã®ã§ã€ `config.hosts` ã®èª¿æ•´ã‚’è¦ã™ã‚‹
- codespace ç‹¬è‡ªã®å•é¡Œ (2025/04/30 æ™‚ç‚¹)
  - POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡¦ç†ã§ããªã„
    - HTTP Origin ãƒ˜ãƒƒãƒ€ã«ã‚ˆã‚‹ã‚µã‚¤ãƒˆã®ã‚ªãƒªã‚¸ãƒ³ãƒã‚§ãƒƒã‚¯ã«ã²ã£ã‹ã‹ã‚‹ã®ã§  `config.action_controller.forgery_protection_origin_check` ã‚’ `false` ã«æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
  - åˆæœŸçŠ¶æ…‹ã§ GitHub Codespaces ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒåŠ¹ã‹ãªã„
    - ä»¥ä¸‹ã„ãšã‚Œã‹ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’è¦ã™ã‚‹
      1. ãƒãƒ¼ãƒˆã®å…¬é–‹ç¯„å›²ã‚’ã€åˆæœŸå€¤ã® Private ã‹ã‚‰ â‡’ Public â‡’ Private ã¨å‹•ã‹ã™ã¨ãªãœã‹ Private ã‚¢ã‚¯ã‚»ã‚¹ (è‡ªåˆ†ã ã‘ã‚¢ã‚¯ã‚»ã‚¹å¯) ãŒæ©Ÿèƒ½ã™ã‚‹
      2. docker image ã‚’ Rails æä¾›ã®ã‚‚ã®ã‹ã‚‰ microsoft æä¾›ã®ã‚‚ã®ã«å·®ã—æ›¿ãˆã‚‹
      3. `.devcontainer/devcontainer.json` ã®è¨­å®šã€ `forwardPorts` ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹

# GitHub Codespaces ã¨ã¯

github ãŒæä¾›ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®é–‹ç™ºç’°å¢ƒã§ã™ã€‚
https://github.com/features/codespaces

ãƒ–ãƒ©ã‚¦ã‚¶ã²ã¨ã¤ã§é–‹ç™ºã‚’å§‹ã‚ã‚‰ã‚Œã‚‹ç’°å¢ƒã§ã™ã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆã® VS Code (github.dev) ã¯åŸºæœ¬çš„ã«ã‚¨ãƒ‡ã‚£ã‚¿ã ã‘ã§ã‚ã‚Šã€å®Ÿéš›ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•ä½œã•ã›ã‚‹ç’°å¢ƒãŒæƒã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€æ–¹ Github Codespaces ã¯ã‚¨ãƒ‡ã‚£ã‚¿ã ã‘ã§ã¯ãªãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•ä½œã•ã›ã‚‹ç’°å¢ƒãŒã¡ã‚ƒã‚“ã¨å‹•ãã¾ã™ã€‚

GitHub ã®ãƒ¦ãƒ¼ã‚¶ã«å¯¾ã—ã€ 15 GB/æœˆ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ãŠã‚ˆã³ 120ã‚³ã‚¢æ™‚é–“ã®ç„¡æ–™æ ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€ GitHub Pro ãƒ¦ãƒ¼ã‚¶ã®å ´åˆã¯ 20 GB/æœˆ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ãŠã‚ˆã³ 180ã‚³ã‚¢æ™‚é–“ã§ã™ã€‚
ã¾ãŸã€codespace ã¯30åˆ†æ”¾ç½®ã§ã‚¢ã‚¤ãƒ‰ãƒ«ã«ã€30æ—¥æ”¾ç½®ã§å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ™‚é–“ã¯è¨­å®š https://github.com/settings/codespaces ã§å¤‰æ›´å¯èƒ½ã§ã™ã€‚

https://docs.github.com/ja/billing/managing-billing-for-your-products/managing-billing-for-github-codespaces

# Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Github Codespaces ã§å‹•ã‹ã™

## `--devcontainer` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ–°ã—ãç”¨æ„ã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ `rails new` ã«ã¯ `--devcontainer` ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€ `.devcontainer/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚‚ã¨ã«ã„ãã¤ã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```console
$ rails new sample --devcontainer
$ cd sample/
$ ls .devcontainer/
compose.yaml  devcontainer.json  Dockerfile
```

ã“ã‚Œã‚‰ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ VS Code ã® dev container ã§é–‹ç™ºç’°å¢ƒã‚’é–‹ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã“ã“ã§ã¯è©³ç´°ã¯çœç•¥ã—ã¾ã™ãŒã€ GitHub Codespaces ã§ã®èµ·å‹•ã§ã‚‚ã“ã®æ§‹æˆã‚’ä½¿ã„ã¾ã™ã€‚

## GitHub Codespaces ã§é–‹ã„ã¦ã¿ã‚‹

ä¸€åº¦ rails new ã‚’å®Ÿæ–½ã—ãŸçŠ¶æ…‹ã‹ã‚‰ first commit ã‚’å…¥ã‚Œã¦ GitHub ã®ãƒªãƒã‚¸ãƒˆãƒªã« push ã—ã¾ã™ã€‚
ãã®å¾Œã€ `https://codespaces.new/OWNER/REPO` ã® URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ Github Codespaces ã§ã®èµ·å‹•ã‚’ç¢ºèªã™ã‚‹ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™

ã¾ãŸã€ä½™è«‡ã§ã™ãŒ `README.md` ã«ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¿°ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ãƒªãƒ³ã‚¯ã‚’é…ç½®ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```
[![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/OWNER/REPO)
```

ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚

[![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/OWNER/REPO)

:::message
OWNER ãŠã‚ˆã³ REPO ã®ç®‡æ‰€ã¯é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„
:::

## codespace ä¸Šã§ã®æ“ä½œ

èµ·å‹•ã—ã¦ã—ã°ã‚‰ãæ”¾ç½®ã—ã¦ã„ã‚‹ã¨ã€ `bin/setup --skip-server` ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã¯ã€ `--devcontainer` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ `rails new` ã—ãŸã“ã¨ã§ä½œæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹ã¨ã“ã®è¨­å®šã®è¨˜è¿°ãŒç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

```json:.devcontainer/devcontainer.json
  // Use 'postCreateCommand' to run commands after the container is created.
  "postCreateCommand": "bin/setup --skip-server"
```

setup ã‚’çµ‚ãˆãŸã‚‰ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ `rails s` ã§èµ·å‹•ã§ãã¾ã™ã€‚

```console
rails s
```

ã€‚ã€‚ã€‚ ãŒã€å®Ÿã¯ã¾ã ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚ã‚‚ã†å°‘ã—ç¶šãã¾ã™ã€‚

## codespace ã§ã®ãƒãƒ¼ãƒˆè»¢é€ã®è¨­å®šã«ã¤ã„ã¦ã®èª²é¡Œ

GitHub Codespaces ã«ã¯ã€ codespace ã®ä¸­ã§å‹•ã‹ã™ Rails ã‚µãƒ¼ãƒã® `http://localhost:3000` ã«å¯¾ã—ã¦å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã™ã€‚

https://docs.github.com/ja/codespaces/developing-in-a-codespace/forwarding-ports-in-your-codespace

æ—¢å®šã§ã€ãƒãƒ¼ãƒˆã®è¡¨ç¤ºç¯„å›²ã« Private ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã“ã®å ´åˆã¯è‡ªèº«ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ GitHub ã«ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§ã‚ã‚Œã°ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
ã€‚ã€‚ã€‚ãŒã€ç¾æ™‚ç‚¹ã§ã¯åˆæœŸçŠ¶æ…‹ã‹ã‚‰ãªã‚“ã‚‰ã‹ã®å¤‰æ›´ã‚’ã—ãªã„ã¨ãªãœã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚
æ—¢å®šãŒ Private ãªã®ã§ Private ã‚’ç¶­æŒã—ãŸçŠ¶æ…‹ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯ Private -> Public -> Private ã¨å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

:::message
ã“ã®ã€ä¸€æ—¦å¤‰æ›´ã—ãªã„ã¨ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒæ©Ÿèƒ½ã—ãªã„ã¨ã„ã†æŒ™å‹•ã«ã¤ã„ã¦ãƒ¬ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
https://github.com/orgs/community/discussions/156546
https://github.com/rails/devcontainer/issues/83

ãƒ¬ãƒãƒ¼ãƒˆã®è§£æ±ºã®ä»•æ–¹ã«ã‚ˆã£ã¦ã¯ã€ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã¯å°†æ¥ä¸è¦ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
:::

### æ‰‹å‹•ãƒˆã‚°ãƒ«ä»¥å¤–ã®å›é¿ç­–

ä¸Šè¨˜ã®ã¨ãŠã‚Šã€ãƒãƒ¼ãƒˆã®å…¬é–‹ç¯„å›²ã‚’ Private -> Public -> Private ã¨ã„ã£ãŸå¤‰æ›´ã‚’ã™ã‚‹ã“ã¨ã§æœ¬æ¥ã®å…¬é–‹ç¯„å›² Private ã¨ã—ã¦å‹•ãã¾ã™ã€‚
ã“ã®æ“ä½œã§å›°ã‚‰ãªã„å ´åˆã¯ãã‚Œã§è‰¯ã„ã§ã™ãŒã€èµ·å‹•ã—ãŸã‚‰ã™ãã«å…¬é–‹ç¯„å›²ãŒæ­£ã—ãä½œç”¨ã—ã¦æ¬²ã—ã„å ´åˆã¯ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

(ã—ã‹ã—ã€ã“ã‚Œã‚‰ã¯ `rails new` ã—ã¦ã™ãã« codespace ã§é–‹ç™ºã‚’å§‹ã‚ã‚‰ã‚Œã‚‹ã‹ã¨ã„ã†è¦³ç‚¹ã‹ã‚‰ã‚ã¾ã‚Šå¥½ã¾ã—ãã¯ãªã„ãªã¨è€ƒãˆã¦ã„ã‚‹ã®ã§ä»Šå¾Œæ”¹å–„ã•ã‚Œã‚Œã°è‰¯ã„ãªã¨æ€ã„ã¾ã™ã€‚)

#### Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å·®ã—æ›¿ãˆ

`rails new --devcontainer` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç”Ÿæˆã•ã‚Œã‚‹ devcontainer ã«é–¢ã™ã‚‹è¨­å®šã§ã™ãŒã€ãã“ã§ä»¥ä¸‹ã®è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚

```dockerfile:.devcontainer/Dockerfile
# Make sure RUBY_VERSION matches the Ruby version in .ruby-version
ARG RUBY_VERSION=3.4.2
FROM ghcr.io/rails/devcontainer/images/ruby:$RUBY_VERSION
```

Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã€€https://github.com/rails/devcontainer ã® `ghcr.io/rails/devcontainer/images/ruby` ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’ microsoft ãŒæä¾›ã—ã¦ã„ã‚‹ ruby ã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ `mcr.microsoft.com/devcontainers/ruby` ã¨å·®ã—æ›¿ãˆã¾ã™ã€‚

```diff:.devcontainer/Dockerfile
 # Make sure RUBY_VERSION matches the Ruby version in .ruby-version
 ARG RUBY_VERSION=3.4.2
+FROM ghcr.io/rails/devcontainer/images/ruby:$RUBY_VERSION
-FROM mcr.microsoft.com/devcontainers/ruby:3.4
```

ã™ã‚‹ã¨ã€æœ¬ä»¶ã®ãƒãƒ¼ãƒˆè»¢é€ã«é–¢ã™ã‚‹å•é¡Œã¯å›é¿ã§ãã€ã¯ã˜ã‚ã‹ã‚‰ Private ã®ãƒãƒ¼ãƒˆè»¢é€ã®è¨­å®šãŒåŠ¹ã„ãŸçŠ¶æ…‹ã§å§‹ã‚ã‚‰ã‚Œã¾ã™ã€‚

#### `forwardPorts` ã‚’å‰Šé™¤

`--devcontainer` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¦ `rails new` ã—ãŸ `.devcontainer/devcontainer.json` ã«ã€ä»¥ä¸‹ã®è¨˜è¿°ãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚
ã‚³ãƒ³ãƒ†ãƒŠå†…ã§é–‹ã„ã¦ã„ã‚‹ãƒãƒ¼ãƒˆã‚’ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³å´ã«è‡ªå‹•ã§è»¢é€ã™ã‚‹ãŸã‚ã®è¨­å®šé …ç›®ãªã®ã§ã™ãŒã“ã‚Œã‚’ç„¡åŠ¹ã—ã€å®Ÿéš›ã« 3000ç•ªãƒãƒ¼ãƒˆãŒä½¿ã‚ã‚Œã‚‹éš›ã®è‡ªå‹•æ¤œå‡ºã«é ¼ã‚‹ã‚ˆã†ã«ã™ã‚Œã° Private ã®ãƒãƒ¼ãƒˆè»¢é€ã®è¨­å®šãŒåŠ¹ã„ãŸçŠ¶æ…‹ã§å§‹ã‚ã‚‰ã‚Œã¾ã™ã€‚

```diff:.devcontainer/devcontainer.json
   // Use 'forwardPorts' to make a list of ports inside the container available locally.
-  "forwardPorts": [3000],
+  // "forwardPorts": [3000],
```

## Blocked hosts ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã™ã‚‹

ã“ã®çŠ¶æ…‹ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç”Ÿã˜ã¾ã™ã€‚

![](/images/blocked-hosts.png)

```
Blocked hosts: symmetrical-spoon-6vxqqgxx4cr6qq-3000.app.github.dev
To allow requests to these hosts, make sure they are valid hostnames (containing only numbers, letters, dashes and dots), then add the following to your environment configuration:
    config.hosts << "symmetrical-spoon-6vxqqgxx4cr6qq-3000.app.github.dev"

For more details view: the Host Authorization guide
```

ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã« `config.hosts` ã«ãƒ›ã‚¹ãƒˆåã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
GitHub Codespaces ã§å®Ÿè¡Œã™ã‚‹éš›ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã„ã¾ã™ã€‚

```ruby:config/environments/development.rb

Rails.application.configure do
  if ENV["CODESPACES"] == "true"
    # ä»¥ä¸‹ã¯ codespace ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ hosts ã«åŠ ãˆã¦ã„ã¾ã™ã€‚
    # åˆ¥è§£ã¨ã—ã¦ã€é¢å€’ã§ã‚ã‚Œã° config.hosts.clear ã—ã¦ã—ã¾ã†ã¨ã„ã†æ‰‹ã‚‚ã‚ã‚Šã¾ã™ã€‚ 
    #
    codespaces_port_forwarding_domain = ENV["GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN"]
    codespace_name = ENV["CODESPACE_NAME"]
    host = "#{codespace_name}-3000.#{codespaces_port_forwarding_domain}"

    config.hosts << host
  end

  # çœç•¥...
end
```

`config/environments/development.rb` ã‚’ä¿®æ­£å¾Œã€èµ·å‹•ã•ã›ã¦ã„ã‚‹ `rails s` ã‚’ä¸€åº¦æ­¢ã‚ã¦å†åº¦å‹•ã‹ã—ã€
æ”¹ã‚ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ç„¡äº‹ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

## POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡¦ç†ã§ããªã„

ä¸Šè¨˜ã¾ã§ã®æ‰‹é †ã§ã€ GitHub Codespaces ã§ Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã—ã¾ã™ã€‚
ãŒã€å®Ÿã¯ã¾ã  GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆã ã‘ã—ã‹å‡¦ç†ã§ããšã€ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ã£ãŸæ©Ÿèƒ½ãªã©ã‚’ä½œã‚‹ã¨ã“ã®å•é¡Œã«ã‚ãŸã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```
ActionController::InvalidAuthenticityToken (HTTP Origin header (http://localhost:3000) didn't match request.base_url (https://symmetrical-spoon-6vxqqgxx4cr6qq-3000.app.github.dev)):
```

ã“ã‚Œã¯å®Ÿéš›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® URL ã«å¯¾ã—ã€ Http Origin Header ã®å†…å®¹ãŒã‚¢ãƒ³ãƒãƒƒãƒã‚†ãˆã«ç”Ÿã˜ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚

```
(ruby) request.base_url
"https://symmetrical-spoon-6vxqqgxx4cr6qq-3000.app.github.dev"
(ruby) request.origin
"http://localhost:3000"
(rdbg)
```

ã—ã‹ã—ãªãŒã‚‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã¯ãŸã—ã‹ã« Origin Header ã¯ç¾åœ¨ã‚¢ã‚¯ã‚»ã‚¹ä¸­ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŸºã¥ã„ãŸå€¤ãŒé€å‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚

![](/images/origin-header.png)

ã“ã‚Œã¯ã€ã©ã†ã‚„ã‚‰ GitHub Codespaces ãŒãƒãƒ¼ãƒˆã‚’å¤–éƒ¨è§£æ”¾ã™ã‚‹ãŸã‚ã®é–“ã«å­˜åœ¨ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä¸­ã§ Origin ãƒ˜ãƒƒãƒ€ãŒæ›¸ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚
æœ¬ä»¶ã«ã¤ã„ã¦ã¯ã€ãƒ¬ãƒãƒ¼ãƒˆã—ã¦ã¿ã¦ã„ã‚‹ã®ã§ä»Šå¾ŒçŠ¶æ³ãŒå¤‰ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ (çŠ¶æ³ãŒå¤‰ã‚ã‚Œã°æœ¬è¨˜äº‹ã‚‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã™)

https://github.com/orgs/community/discussions/156532

## GitHub Codespaces ã§ã®ç’°å¢ƒã«é™ã‚Š POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

:::message
Origin ãƒ˜ãƒƒãƒ€ãŒæ›¸ãæ›ã‚ã‚‹ä»¶ã«ã¤ã„ã¦ã€ãƒ¬ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
https://github.com/orgs/community/discussions/156532

ãƒ¬ãƒãƒ¼ãƒˆã®è§£æ±ºã®ä»•æ–¹ã«ã‚ˆã£ã¦ã¯ã€ä»¥ä¸‹ã«è¨˜è¼‰ã—ã¦ã„ã‚‹ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã¯å°†æ¥ä¸è¦ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
:::

ã“ã®ãƒã‚§ãƒƒã‚¯ã¯ã€ Rails ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šå€¤ `config.action_controller.forgery_protection_origin_check` ã«ã‚ˆã‚Šå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

[3.9.8 config.action_controller.forgery_protection_origin_check](https://railsguides.jp/configuring.html#config-action-controller-forgery-protection-origin-check)
> CSRFã®è¿½åŠ å¯¾ç­–ã¨ã—ã¦ã€HTTPã®Originãƒ˜ãƒƒãƒ€ãƒ¼ãŒã‚µã‚¤ãƒˆã®originã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ãƒã‚§ãƒƒã‚¯ã™ã¹ãã‹ã©ã†ã‹ã‚’è¨­å®šã—ã¾ã™ã€‚

æœ¬æ¥ã¯æ—¢å®šå€¤ã‚’å¯èƒ½ãªé™ã‚Šå°Šé‡ã—ãŸã„ã®ã§ã™ãŒã€ GitHub Codespaces ã§å‹•ä½œã•ã›ã‚‹å ´åˆã«ã“ã®è¨­å®šå€¤ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã—ãŸã€‚

```diff ruby:config/environments/development.rb

 Rails.application.configure do
   if ENV["CODESPACES"]
     codespaces_port_forwarding_domain = ENV["GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN"]
     codespace_name = ENV["CODESPACE_NAME"]
     host = "#{codespace_name}-3000.#{codespaces_port_forwarding_domain}"

     config.hosts << host
+
+    warn "Disabling the CSRF protection Origin header check in GitHub Codespaces"
+    config.action_controller.forgery_protection_origin_check = false
   end

```

ã“ã‚Œã«ã‚ˆã‚Šã€ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¤ã„ã¦ã‚‚æœŸå¾…ã©ãŠã‚Šå‹•ä½œã™ã‚‹ã‚ˆã†ã«ã§ãã¾ã—ãŸï¼

# ã¾ã¨ã‚ & å®£ä¼

ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§é–‹ç™ºç’°å¢ƒã‚’æ°—è»½ã«ä½“é¨“ã§ãã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç’°å¢ƒã¨ã—ã¦ Github Codespaces ã¯è‰¯ã„é¸æŠã ã¨æ€ã„ã¾ã™ã€‚å½“ç„¶ãã®ã¾ã¾å®Ÿè¡Œã‚‚ã§ãã¾ã™ã€‚
Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•ã‹ã™ãŸã‚ã«ã¯å‰è¿°ã®ã¨ãŠã‚Šã„ãã¤ã‹ã®èª¿æ•´ãŒå¿…è¦ã§ã—ãŸã€‚ã¾ãŸã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®è¨­å®šã«æ°—ã‚’ã¤ã‘ã‚‹ç‚¹ãŒã‚ã‚Šã¾ã™ãŒãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã‚‚ã‚ã‚Šã¾ã™ã€‚

é–¢é€£ã—ãŸå®£ä¼ã§ã™ãŒã€ Rails ã§è¤‡æ•°ã® ActiveRecord ãƒ¢ãƒ‡ãƒ«ã‚’å†…åŒ…ã—ã€ã‚ãŸã‹ã‚‚ãã‚ŒãŒã²ã¨ã¤ã®ãƒ¢ãƒ‡ãƒ«ã§ã‚ã‚‹ã‚ˆã†ã«æŒ¯ã‚‹èˆã†ã“ã¨ã“ã¨ã‚’æä¾›ã™ã‚‹ active_record_compose ã¨ã„ã† gem ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’ã€å®Ÿéš›ã« GitHub Codespaces ä¸Šã§è©¦ã™ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã®ã§ã‚ˆã‘ã‚Œã°ã•ã‚ã£ã¦ã¿ã¦ãã ã•ã„ã€‚æ—¥æœ¬èª README ã‚‚ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

https://github.com/hamajyotan/active_record_compose
https://github.com/hamajyotan/active_record_compose-example

ã¾ãŸã€ã“ã® gem ãã®ã‚‚ã®ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã«è¨˜äº‹ã‚’ãŠã„ã¦ã„ã¾ã™ã€‚

https://zenn.dev/hamajyotan/articles/3e618ed8b6d22b
